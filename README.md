# 🚄 桃叔12306 抢票助手 v1.0

<div align="center">

![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)
![License](https://img.shields.io/badge/License-MIT-green.svg)
![Platform](https://img.shields.io/badge/Platform-Windows-lightgrey.svg)

**基于 Selenium 的自动化抢票工具，让春运抢票更轻松！**

[功能特性](#-功能特性) • [快速开始](#-快速开始) • [操作手册](#-操作手册) • [部署流程](#-部署流程) • [常见问题](#-常见问题)

</div>

---

## 📖 项目简介

桃叔12306 抢票助手是一款基于 Selenium WebDriver 的自动化抢票工具，专注于图形界面（GUI）使用模式。通过智能化的抢票策略和持续监控功能，帮助用户在12306官网快速抢到心仪的车票。

### ✨ 功能特性

- 🖥️ **友好 GUI 界面**：直观的图形界面，操作简单易用
- 🎯 **双策略抢票**：
  - 时间范围策略：在指定时间段内抢最早的车次
  - 指定车次策略：精准抢购指定车次号
- 🔐 **预登录功能**：提前完成登录，抢票时无需等待
- ⚡ **高速刷新**：智能刷新间隔，提高抢票成功率
- 💾 **配置保存**：支持保存常用配置，一键加载
- 📱 **扫码登录**：使用12306 APP扫码，安全便捷
- 🎫 **多票型支持**：成人票、学生票自由选择
- 🪑 **智能选座**：支持座位偏好设置
- 🛌 **多席别支持**：一等座、二等座、商务座、硬座、硬卧、软卧、一等卧、二等卧
- 👤 **乘车人选择**：支持按姓名选择乘车人
- 🔔 **钉钉机器人通知**：实时推送抢票状态和结果
- 📊 **持续监控**：无限期监控目标车次，有票立即预订
- 📝 **详细日志**：完整的错误日志和运行记录

---

## 🚀 快速开始

### 环境要求

- Python 3.8 或更高版本
- Microsoft Edge 浏览器（最新版本）
- Windows 操作系统
- 稳定的网络连接

### 安装步骤

1. **克隆项目**
```bash
git clone https://github.com/243988114/12306-ticket-tool.git
cd 12306-ticket-tool-main
```

2. **安装依赖**
```bash
pip install selenium requests
```

3. **启动应用**
```bash
python gui_app.py
```

---

## 📚 操作手册

### GUI 界面介绍

#### 1. 基础信息区域

| 选项 | 说明 | 示例 |
|------|------|------|
| 出发站 | 填写完整的出发站名称 | 杭州 |
| 到达站 | 填写完整的到达站名称 | 郑州 |
| 出发日期 | 填写出发日期，格式：YYYY-MM-DD | 2026-02-12 |
| 票型 | 选择成人票或学生票 | 成人票 |
| 席别 | 选择座位类型 | 一等卧 |
| 乘车人 | 填写乘车人姓名 | 张航铭 |

#### 2. 高级选项区域

| 选项 | 说明 | 示例 |
|------|------|------|
| 抢票策略 | 选择时间范围或指定车次 | 指定车次 |
| 时间范围 | 选择出发时间范围（时间范围策略） | 07:00 - 09:00 |
| 目标车次 | 填写目标车次号（指定车次策略） | D230 |
| 选座偏好 | 选择座位偏好 | window（靠窗） |
| 开售时间 | 填写开售时间，格式：YYYY-MM-DD HH:MM:SS | 2026-02-03 21:30:00 |

#### 3. 钉钉机器人配置区域

| 选项 | 说明 | 示例 |
|------|------|------|
| 钉钉机器人Token | 填写钉钉机器人的access_token | 
填写你的机器人token |
| 钉钉机器人Secret | 填写钉钉机器人的加签密钥 |  |
填写你的机器人

### 操作流程

1. **启动应用**：运行 `gui_app.py` 文件
2. **配置参数**：
   - 填写基础信息（出发站、到达站、日期等）
   - 选择席别（支持一等卧、二等卧等）
   - 填写乘车人姓名
   - 选择抢票策略（指定车次或时间范围）
   - 配置钉钉机器人信息（可选）
3. **预登录**：
   - 点击 **🔐 预登录12306** 按钮
   - 等待浏览器打开
   - 使用12306 APP扫码登录
   - 登录成功后，状态显示"✓ 已登录"
4. **开始抢票**：
   - 点击 **🚀 开始抢票** 按钮
   - 确认抢票参数
   - 系统开始监控目标车次
5. **监控过程**：
   - 系统会持续监控目标车次
   - 无票时保持监控，不报错停止
   - 有票时立即尝试预订
   - 每30分钟发送一次监控状态通知
6. **抢票结果**：
   - 成功抢到票后，系统会自动尝试提交订单
   - 钉钉机器人会发送抢票成功通知
   - 浏览器会停留在订单页面，等待用户支付

### 抢票策略详解

#### 策略一：时间范围抢票

**适用场景**：对车次无特殊要求，只要在某个时间段内出发即可

**工作原理**：
1. 扫描查询结果中所有车次
2. 筛选出发时间在指定范围内的车次
3. 按出发时间从早到晚排序
4. 优先抢购最早的可预订车次

**配置示例**：
- 出发时间：07:00
- 结束时间：09:00

#### 策略二：指定车次抢票

**适用场景**：明确知道要抢的车次号，需要持续监控

**工作原理**：
1. 精确定位目标车次号（如 D230）
2. 高频刷新查询结果
3. 一旦出现可预订按钮立即点击
4. 无票时持续监控，不报错停止

**配置示例**：
- 目标车次：D230

---

## 🛠️ 部署流程

### 步骤1：环境准备

1. **安装 Python**
   - 访问 [Python官网](https://www.python.org/downloads/) 下载最新版本
   - 安装时勾选"Add Python to PATH"
   - 验证安装：
     ```bash
     python --version
     ```

2. **安装 Microsoft Edge 浏览器**
   - 确保安装最新版本的 Edge 浏览器
   - 验证版本：在 Edge 中访问 `edge://version`

### 步骤2：项目部署

1. **下载项目**
   - 通过 Git 克隆：
     ```bash
     git clone https://github.com/243988114/12306-ticket-tool.git
     cd 12306-ticket-tool-main
     ```
   - 或直接下载 ZIP 文件并解压

2. **安装依赖**
   ```bash
   pip install selenium requests
   ```

3. **配置默认参数**
   - 打开 `gui_app.py` 文件
   - 检查默认配置参数是否正确
   - 如需修改，可在 GUI 界面中调整

### 步骤3：启动应用

1. **运行应用**
   ```bash
   python gui_app.py
   ```

2. **创建快捷方式（可选）**
   - 右键点击 `gui_app.py` 文件
   - 选择"发送到" → "桌面快捷方式"
   - 在快捷方式属性中，修改"目标"为：
     ```
     "C:\Python314\python.exe" "H:\个人项目\12306\12306-ticket-tool-main\gui_app.py"
     ```
   - 点击"高级"按钮，勾选"以管理员身份运行"

### 步骤4：验证部署

1. **测试预登录**
   - 点击"预登录12306"按钮
   - 确认浏览器能正常打开
   - 尝试扫码登录

2. **测试抢票功能**
   - 填写测试参数
   - 选择一个当前无票的车次进行监控
   - 确认系统能持续监控，不报错停止

3. **测试通知功能**
   - 配置钉钉机器人信息
   - 开始抢票
   - 确认能收到钉钉通知

---

## � 钉钉机器人通知

### 功能说明

钉钉机器人可以实时推送以下通知：

1. **任务开始通知**：包含抢票详细信息
2. **抢票成功通知**：告知用户已成功抢到票
3. **监控异常通知**：推送异常信息和错误详情
4. **30分钟状态通知**：定期发送运行状态、监控次数、任务健康状况
5. **任务结束通知**：告知任务结束原因和结果

### 配置方法

1. **创建钉钉机器人**
   - 打开钉钉群组
   - 点击"群设置" → "智能群助手" → "添加机器人" → "自定义"
   - 填写机器人名称，如"12306抢票助手"
   - 安全设置选择"加签"
   - 复制生成的 Webhook URL 和加签密钥

2. **配置应用**
   - 在 GUI 界面的"钉钉机器人配置"区域
   - Token：填写 Webhook URL 中的 access_token 部分
   - Secret：填写加签密钥

3. **验证通知**
   - 开始抢票后，检查钉钉群是否收到通知
   - 如未收到，检查 Token 和 Secret 是否正确

### 通知示例

**任务开始通知：**
```markdown
## 抢票任务开始
> 出发站: 杭州
> 到达站: 郑州
> 日期: 2026-02-12
> 票型: adult
> 席别: 一等卧
> 乘车人: 张航铭
> 车次: D230
> 开始时间: 2026-02-04 10:00:00
```

**30分钟状态通知：**
```markdown
## 抢票任务运行状态
> 已运行时间: 30.5分钟
> 监控次数: 450
> 目标车次: D230
> 出发站: 杭州
> 到达站: 郑州
> 日期: 2026-02-12
> 席别: 一等卧
> 乘车人: 张航铭
> 状态: 正常监控中
> 检查时间: 2026-02-04 10:30:00
```

---

## 🛠️ 项目结构

```
12306-ticket-tool-main/
├── gui_app.py               # GUI主程序
├── booking_core.py          # 核心抢票逻辑
├── config.json              # 配置文件
├── 12306_booking.log        # 日志文件
├── README.md                # 项目说明文档
├── LICENSE                  # 开源协议
└── test_login.py            # 登录测试脚本
```

**文件说明**：
- `gui_app.py`：图形界面主程序，负责用户交互和参数收集
- `booking_core.py`：核心抢票逻辑，包含浏览器自动化和抢票策略
- `config.json`：配置文件，存储用户的抢票参数
- `12306_booking.log`：日志文件，记录运行过程和错误信息

---

## ❓ 常见问题

### Q1: 运行时提示"No module named 'selenium'"

**解决方法**：
```bash
pip install selenium
```

### Q2: 浏览器打开后无法自动操作

**可能原因**：
- Edge WebDriver 版本与浏览器版本不匹配
- 需要更新 Edge 浏览器到最新版本

**解决方法**：
1. 检查 Edge 版本：`edge://version`
2. 下载对应版本的 WebDriver：[Edge WebDriver 下载页](https://developer.microsoft.com/en-us/microsoft-edge/tools/webdriver/)
3. 将 WebDriver 解压到 Python 安装目录或添加到环境变量

### Q3: 点击登录按钮失败

**解决方法**：
- 使用 GUI 的"预登录"功能，手动完成登录
- 12306 网站结构可能有变化，等待脚本更新

### Q4: 选择乘车人失败

**可能原因**：
- 乘车人姓名填写错误
- 12306 网站结构有变化

**解决方法**：
- 确认乘车人姓名与12306账户中完全一致
- 如仍失败，系统会自动选择第一个乘车人

### Q5: 监控过程中自动结束

**可能原因**：
- 网络连接中断
- 浏览器被手动关闭
- 12306 网站登录超时

**解决方法**：
- 确保网络连接稳定
- 不要手动关闭浏览器
- 如登录超时，重新使用"预登录"功能

### Q6: 钉钉通知发送失败

**可能原因**：
- Token 或 Secret 填写错误
- 网络连接问题
- 钉钉机器人安全设置错误

**解决方法**：
- 确认 Token 和 Secret 填写正确
- 检查网络连接
- 确保钉钉机器人安全设置为"加签"

### Q7: 抢票成功率如何提高？

**建议**：
1. 使用"指定车次"策略，刷新频率更高
2. 设置准确的开售时间，提前进入等待状态
3. 网络环境要稳定，建议使用有线网络
4. 提前完成预登录，确保登录状态正常
5. 选择席别时，优先选择余票较多的席别
6. 保持电脑屏幕常亮，避免系统休眠

---

## 📝 日志说明

### 日志文件

- **文件位置**：`12306_booking.log`
- **日志级别**：INFO、WARNING、ERROR
- **记录内容**：
  - 程序启动和停止信息
  - 抢票过程中的关键步骤
  - 错误信息和异常堆栈
  - 钉钉通知发送状态

### 查看日志

1. **GUI 运行日志**：在应用的"运行日志"区域查看 INFO 级别日志
2. **完整日志**：打开 `12306_booking.log` 文件查看所有级别的日志

### 日志示例

```
2026-02-04 10:00:00 - INFO - ✓ 已打开12306官网
2026-02-04 10:00:05 - INFO - ✓ 已点击登录按钮
2026-02-04 10:00:30 - INFO - ✓ 登录成功！
2026-02-04 10:01:00 - INFO - 🚀 到达抢票时间，开始抢票！
2026-02-04 10:01:05 - INFO - 策略：指定车次 [D230]
2026-02-04 10:01:10 - INFO - 发现目标车次 D230，检查是否有票...
2026-02-04 10:01:15 - INFO - 目标车次 D230 暂无票或不可预订，继续监控...
2026-02-04 10:01:18 - INFO - 继续监控车次 D230，等待3.5s后重试...
```

---

## ⚠️ 免责声明

- 本项目仅供学习交流使用，请勿用于商业用途
- 使用本工具产生的任何后果由使用者自行承担
- 请遵守12306官网的使用规则和相关法律法规
- 建议合理使用，避免对12306服务器造成过大压力
- 抢票过程中请保持电脑和网络稳定，避免因意外情况导致抢票失败

---

## 📄 开源协议

本项目采用 [MIT License](LICENSE) 开源协议

---

## 🌟 支持一下

如果这个项目对你有帮助，请给个 Star ⭐️ 支持一下！

---
